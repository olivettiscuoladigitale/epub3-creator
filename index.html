<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <title>EpubCreator test</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="demo/materialize/css/materialize.min.css" media="screen,projection"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script src="node_modules/rsvp/dist/rsvp.js"></script>
    <script src="demo/epubjs/jszip.min.js"></script>

    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="demo/materialize/js/materialize.min.js"></script>
    <!--
 <script src="demo/epubjs/epub.min.js"></script>

<script src="node_modules/systemjs/dist/system.js"></script>
 <script src="node_modules/jquery/dist/jquery.min.js"></script>

 <script>
     // set our baseURL reference path
     SystemJS.config({
         baseURL: '/dist'
     });

     // loads /js/main.js
     SystemJS.import('epub-creator.js').then(function (module) {

         var content = [
             {
                 tag: "section", name: "frontmatter", "content": [
                 {
                     tag: "section", name: "titlepage", "content": [
                     {tag: "html", content: "<h1>My book title Section</h1> 	<div class='aut'>Author</div>"},
                     {
                         tag: "div",
                         name: "epigraph",
                         content: "<span xml:lang=\"la\">\"Nam Sibyllam quidem Cumis ego ipse oculismeis<br />vidi in ampulla pendere, et cum illi pueri dicerent</span>: <br /> "
                     },
                 ]
                 }
             ]
             },
             {
                 tag: "section", name: "bodymatter", "content": [
                 {tag: "section", id: "ch1", navLabel: "Chapter 1", content: "Body content for chapter1"},
                 {tag: "section", id: "ch2", navLabel: "Chapter 2", content: "Body content for chapter2"}
             ]
             }
         ];


         var epubCreator = new module.EpubCreator();

         epubCreator.template("epub3");
         epubCreator.properties.title = "Alfabook book title";
        // epubCreator.properties.cover.file = "./demo/cover.jpg";
         epubCreator.addSections(content);
         epubCreator.addCss({
             "content": "@namespace '@charset 'UTF-8'; http://www.w3.org/1999/xhtml'; @namespace epub 'http://www.idpf.org/2007/ops'; body: { margin-left:6em, margin-right:2em}",
             "name": "base.css"
         });

         jQuery("#download").click(function () {
             epubCreator.download();
         });

         epubCreator.blobUrl().then(function(content) {

             console.log(content);

             /*
             var url = "";

                 var url = URL.createObjectURL(content);
                 console.log("URL:",url);
                 */

             var Book = ePub({
                 bookPath: content,
                 width: 400,
                 height: 600,
                 spreads: false
             });

             Book.renderTo("area");

             jQuery("prev").click(() => {
                 Book.prevPage();
             });

             jQuery("next").click(() => {
                 Book.nextPage();
             });


         }, function(err) {

             console.log(err);
         });





     });













 </script>
 !-->
    <link rel="stylesheet" href="demo/epubjs/basic.css">


    <style type="text/css">
        body {
            overflow: auto;
            background: #eee;
        }

        #wrapper {
            width: 480px;
            height: 640px;
            overflow: hidden;
            border: 1px solid #ccc;
            margin: 20px auto;
            background: #fff;
            border-radius: 0 5px 5px 0;
        }

        #area {
            width: 480px;
            height: 650px;
            margin: -5px auto;
            -moz-box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
            -webkit-box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
            box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
            padding: 40px 40px;
        }

        .text-prop {
            margin-top: 750px;
            height: 350px;
            text-align: center;
            background-color: #ffffff;
        }

        #editor {
            height: 500px;
            right: 0;
            left: 0;
        }
    </style>


</head>
<body>

<nav class="navbar-fixed teal">
    <div class="nav-wrapper">
        <a href="#" class="brand-logo" style="padding-left:15px;">
            Epub-creator Demo
        </a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a id="download" class="waves-effect waves-light btn purple">Download Book</a></li>
            <li><a id="showepub" class="waves-effect waves-light btn purple">Load Epub</a></li>
            <li><a href="http://www.alfabook.it/">Contact</a></li>
        </ul>
    </div>
</nav>

<br/>
<br/>

<div id="main">
    <div id="prev" class="arrow">‹</div>
    <div id="wrapper">
        <div id="area"></div>
    </div>
    <div id="next" class="arrow">›</div>
</div>


<div class="row" style="position: absolute; top:800px; width: 100%">
    <div class="col s12">
        <ul class="tabs">
            <li class="tab col s3"><a href="#test1" class="active">Properties</a></li>
            <li class="tab col s3"><a href="#test2">Test 2</a></li>
            <li class="tab col s3"><a href="#test3">Test 3</a></li>
            <li class="tab col s3"><a href="#test4">Test 4</a></li>
        </ul>
    </div>
    <div id="test1" class="col s12">
        <div id="editor"></div>
        <div style="height: 50px; width: 100%"></div>
    </div>
    <div id="test2" class="col s12">Test 2</div>
    <div id="test3" class="col s12">Test 3</div>
    <div id="test4" class="col s12">Test 4</div>
</div>


<textarea id="code" style="display: none">
    {"ciccio":1}
</textarea>


<script type="text/javascript" src="dist/epub-creator.js" charset="utf-8"></script>
<script src="node_modules/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    // use ace editor to edit code

    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/json");

    setInterval(function () {
        var codeEl = jQuery("#code");
        var val = codeEl.val();

        if (val && val != "[]") {
            console.log("*************code: ", val);
            editor.setValue(val);
            codeEl.val("[]");
        }
    }, 1000);


</script>

</body>
</html>